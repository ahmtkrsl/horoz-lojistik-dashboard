<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Horoz Lojistik - Tahmin Performans Dashboard</title>

  <!-- Leaflet CSS -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
        integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY="
        crossorigin="" />

  <!-- Google Fonts: Inter -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">

  <!-- Dashboard CSS -->
  <link rel="stylesheet" href="css/style.css">
</head>
<body>

  <!-- ============================================================= -->
  <!-- HEADER                                                         -->
  <!-- ============================================================= -->
  <header class="header">
    <div class="header-content">
      <div class="header-left">
        <h1>Horoz Lojistik</h1>
        <p class="header-subtitle">Aktarma Merkezi Tahmin Performans Dashboard</p>
      </div>
      <button id="btn-info" class="btn-info" title="Kullanim Kilavuzu">i</button>
    </div>
  </header>

  <!-- ============================================================= -->
  <!-- ANA ICERIK (harita + kartlar + tablolar)                       -->
  <!-- ============================================================= -->
  <div id="main-content">

    <!-- HARITA -->
    <section class="map-section">
      <div id="map"></div>
      <div class="map-legend">
        <div class="legend-title">Nokta Buyuklugu</div>
        <div class="legend-item">
          <span class="legend-circle legend-small"></span> Dusuk Desi
        </div>
        <div class="legend-item">
          <span class="legend-circle legend-large"></span> Yuksek Desi
        </div>
        <div class="legend-divider"></div>
        <div class="legend-title">Renk</div>
        <div class="legend-item">
          <span class="legend-color" style="background:#27ae60"></span> Dusuk Hata
        </div>
        <div class="legend-item">
          <span class="legend-color" style="background:#e74c3c"></span> Yuksek Hata
        </div>
      </div>
    </section>

    <!-- OZET KARTLAR -->
    <section class="summary-section">
      <div class="summary-cards">
        <div class="card">
          <div class="card-label">Toplam Merkez</div>
          <div class="card-value" id="stat-merkez">-</div>
        </div>
        <div class="card">
          <div class="card-label">En Sik Top-3'e Giren Model</div>
          <div class="card-value" id="stat-best-model">-</div>
        </div>
        <div class="card">
          <div class="card-label">Ort. Holdout Hata (%)</div>
          <div class="card-value" id="stat-avg-hata">-</div>
        </div>
        <div class="card">
          <div class="card-label">Son Guncelleme</div>
          <div class="card-value" id="stat-update">-</div>
        </div>
      </div>
    </section>

    <!-- TABLO FILTRE -->
    <section class="filter-section">
      <div class="filter-bar">
        <div class="filter-left">
          <label for="merkez-select">Aktarma Merkezi:</label>
          <select id="merkez-select">
            <option value="">Tumu</option>
          </select>
        </div>
        <div class="filter-right">
          <button id="btn-detail" class="btn-detail" style="display:none">Detay</button>
          <button id="btn-reset" class="btn-reset" style="display:none">Filtreyi Kaldir</button>
        </div>
      </div>
    </section>

    <!-- TABLOLAR -->
    <section class="tables-section">
      <div class="table-container">
        <div class="table-card">
          <h2>Validation WMAE Siralamasi</h2>
          <div class="table-wrapper">
            <table id="table-wmae">
              <thead>
                <tr>
                  <th>Merkez</th>
                  <th>Model</th>
                  <th>WMAE</th>
                  <th>Sira</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div class="table-card">
          <h2>Holdout Hata Karsilastirmasi</h2>
          <div class="table-wrapper">
            <table id="table-holdout">
              <thead>
                <tr>
                  <th>Merkez</th>
                  <th>Model</th>
                  <th>Tahmin Toplam</th>
                  <th>Gercek Toplam</th>
                  <th>Hata %</th>
                  <th>Sira</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

  </div><!-- /main-content -->

  <!-- ============================================================= -->
  <!-- DETAY PANELI (varsayilan gizli)                                -->
  <!-- ============================================================= -->
  <div id="detail-panel" style="display:none">

    <!-- Geri don + baslik -->
    <section class="detail-header-section">
      <div class="detail-header">
        <button id="btn-back" class="btn-back">&larr; Ana Sayfaya Don</button>
        <h2 id="detail-title">Merkez Detay</h2>
      </div>
    </section>

    <!-- Filtreler -->
    <section class="detail-filters-section">
      <div class="detail-filters">
        <div class="detail-filter-group">
          <label for="detail-merkez-select">Aktarma Merkezi:</label>
          <select id="detail-merkez-select"></select>
        </div>
        <div class="detail-filter-group">
          <label>Model Secimi (max 3):</label>
          <div id="model-checkbox-group" class="model-checkbox-group"></div>
        </div>
        <div class="detail-filter-group">
          <label class="anomaly-toggle-label">
            <input type="checkbox" id="anomaly-toggle">
            <span class="toggle-slider"></span>
            <span class="toggle-text">Anomali Goster</span>
          </label>
        </div>
      </div>
    </section>

    <!-- Chartlar (max 3 slot) -->
    <section class="detail-charts-section">
      <div id="chart-slot-0" class="chart-slot"></div>
      <div id="chart-slot-1" class="chart-slot"></div>
      <div id="chart-slot-2" class="chart-slot"></div>
    </section>

    <!-- Anomali ozet tablolari -->
    <section class="detail-tables-section">
      <div class="detail-table-container">
        <div class="table-card">
          <h2>Model Bazli Anomali Ozeti</h2>
          <div class="table-wrapper">
            <table id="table-anomaly-summary">
              <thead>
                <tr>
                  <th>Model</th>
                  <th>Toplam Anomali</th>
                  <th>Kritik (4-5)</th>
                  <th>Supheli (3)</th>
                  <th>Olasi (2)</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
        <div class="table-card">
          <h2>Birden Fazla Modelin Ortak Isaretledigi Gunler</h2>
          <div class="table-wrapper">
            <table id="table-anomaly-dates">
              <thead>
                <tr>
                  <th>Tarih</th>
                  <th>Model Sayisi</th>
                </tr>
              </thead>
              <tbody></tbody>
            </table>
          </div>
        </div>
      </div>
    </section>

  </div><!-- /detail-panel -->

  <!-- ============================================================= -->
  <!-- FOOTER                                                         -->
  <!-- ============================================================= -->
  <footer class="footer">
    <p>Horoz Lojistik - Multivariate Time Series Forecasting Projesi</p>
  </footer>

  <!-- ============================================================= -->
  <!-- BILGI SIDEBAR                                                  -->
  <!-- ============================================================= -->
  <div id="info-overlay" class="info-overlay"></div>
  <aside id="info-sidebar" class="info-sidebar">
    <div class="sidebar-header">
      <h3>Kullanim Kilavuzu</h3>
      <button id="btn-sidebar-close" class="btn-sidebar-close">&times;</button>
    </div>
    <div class="sidebar-body">

      <div class="info-section">
        <h4>Harita</h4>
        <p>Haritadaki her nokta bir <strong>aktarma merkezini</strong> temsil eder.</p>
        <ul>
          <li><strong>Nokta buyuklugu:</strong> Tahmini desi hacmini gosterir. Buyuk nokta = yuksek hacim.</li>
          <li><strong>Nokta rengi:</strong> Ortalama hata oranini gosterir. <span class="text-success">Yesil</span> = dusuk hata, <span class="text-danger">kirmizi</span> = yuksek hata.</li>
          <li>Bir noktanin uzerine geldiginizde ozet bilgiler gorunur. Noktaya <strong>tikladiginizda</strong> tablolar o merkeze filtrelenir.</li>
        </ul>
      </div>

      <div class="info-section">
        <h4>WMAE (Validation Performansi)</h4>
        <p><strong>Weighted Mean Absolute Error (WMAE)</strong>, modellerin egitim sonrasi <strong>validation veri seti</strong> uzerinde ne kadar iyi tahmin yaptigini olcer.</p>
        <p>Validation veri seti, modelin egitimi sirasinda kullanilmayan ancak model parametrelerinin ayarlanmasinda referans alinan bir donemdir.</p>
        <p><span class="text-danger"><strong>Dusuk WMAE = Daha iyi gunluk tahmin performansi.</strong></span></p>
      </div>

      <div class="info-section">
        <h4>Holdout Hata Orani</h4>
        <p>Holdout veri seti, modelin <span class="text-danger"><strong>hic gormedigi</strong></span> ve egitim/validation surecinde kullanilmayan tamamen ayrilmis bir donemdir.</p>
        <p>Her model icin bu donemde <strong>30 gunluk tahmin</strong> yaptirilir. Sonrasinda:</p>
        <ul>
          <li>Tahmin edilen 30 gunun <strong>toplami</strong> hesaplanir</li>
          <li>Gercek degerlerin <strong>toplami</strong> hesaplanir</li>
          <li>Aradaki fark yuzdesi hesaplanir:</li>
        </ul>
        <p class="formula"><span class="text-danger"><strong>Hata (%) = |Tahmin Toplam - Gercek Toplam| / Gercek Toplam x 100</strong></span></p>
        <p>Dusuk hata orani, modelin uzun vadede gercege daha yakin tahmin yaptigi anlamina gelir.</p>
      </div>

      <div class="info-section">
        <h4>Puanlama Sistemi (Top 3 Model Secimi)</h4>
        <p>Her aktarma merkezi icin en iyi 3 model su sekilde belirlenir:</p>
        <ol>
          <li><strong>WMAE siralamasi:</strong> Tum modeller WMAE degerine gore kucukten buyuge siralanir (1, 2, 3...)</li>
          <li><strong>Holdout hata siralamasi:</strong> Tum modeller hata oranina gore kucukten buyuge siralanir (1, 2, 3...)</li>
          <li><span class="text-danger"><strong>Kombine puan = WMAE sirasi + Holdout hata sirasi</strong></span></li>
          <li>Kombine puani <strong>en dusuk olan 3 model</strong> = o merkezin en iyi modelleri</li>
        </ol>
        <p>Bu sistem, hem gunluk dogrulukta hem de toplam tahmin dogrulugunda dengeli olan modelleri secmeyi amaclar.</p>
      </div>

      <div class="info-section">
        <h4>Detay Sayfasi</h4>
        <p>Bir aktarma merkezine tikladiginizda tablolar filtrelenir. Filtre cubugunun yaninda gorunen <strong>"Detay"</strong> butonuna basarak detay sayfasina gecebilirsiniz.</p>
        <p>Detay sayfasinda:</p>
        <ul>
          <li><strong>Etkilesimli grafik:</strong> Secilen modelin validation donemindeki gercek ve tahmin degerlerini gorursunuz. Grafikte zoom, pan ve hover yapabilirsiniz.</li>
          <li><strong>Anomali gosterimi:</strong> "Anomali Goster" toggle'ini acarak grafik uzerindeki anomali noktalarini gorebilirsiniz.</li>
          <li><strong>Model karsilastirma:</strong> Ayni anda <span class="text-danger"><strong>maksimum 3 model</strong></span> secebilir ve alt alta grafik olarak karsilastirabilirsiniz.</li>
          <li><strong>Anomali ozet tablolari:</strong> Secilen modellerin anomali istatistikleri ve birden fazla modelin ortak isaretledigi tarihler gosterilir.</li>
        </ul>
      </div>

      <div class="info-section">
        <h4>Anomali Analizi</h4>
        <p>Anomali tespiti icin <strong>5 farkli algoritma</strong> birlikte kullanilir:</p>
        <ol>
          <li>Isolation Forest</li>
          <li>One-Class SVM</li>
          <li>Autoencoder</li>
          <li>Local Outlier Factor (LOF)</li>
          <li>Elliptic Envelope</li>
        </ol>
        <p>Her algoritma bagimsiz olarak "anomali var mi?" sorusuna oy verir. Toplam oy sayisina gore seviye belirlenir:</p>
        <ul>
          <li><span class="text-danger"><strong>Kritik Anomali (4-5 oy):</strong></span> Algoritmalarin buyuk cogunlugu hemfikir. Ciddi sapma.</li>
          <li><strong style="color:#f97316">Supheli Anomali (3 oy):</strong> Orta duzey uzlasma. Incelenmeye deger.</li>
          <li><strong style="color:#eab308">Olasi Anomali (2 oy):</strong> Zayif sinyal. Dikkatli takip gerektirebilir.</li>
        </ul>
      </div>

    </div>
  </aside>

  <!-- ============================================================= -->
  <!-- ILK GIRIS POP-UP                                               -->
  <!-- ============================================================= -->
  <div id="welcome-popup" class="welcome-popup" style="display:none">
    <div class="welcome-popup-backdrop"></div>
    <div class="welcome-popup-card">
      <div class="welcome-popup-icon">&#9432;</div>
      <h3>Hosgeldiniz!</h3>
      <p>Dashboard'u kullanmadan once sag ustteki <strong>"i"</strong> butonuna tiklayarak <strong>kullanim kilavuzunu</strong> okumanizi oneririz.</p>
      <p class="welcome-popup-hint">Kilavuzda puanlama sistemi, hata hesaplamalari ve detay sayfasi hakkinda bilgiler bulunmaktadir.</p>
      <button id="btn-welcome-ok" class="btn-welcome-ok">Anladim</button>
    </div>
  </div>

  <!-- ============================================================= -->
  <!-- SCRIPTS                                                        -->
  <!-- ============================================================= -->
  <!-- Leaflet JS -->
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"
          integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo="
          crossorigin=""></script>

  <!-- Plotly.js (etkiresimli chartlar icin) -->
  <script src="https://cdn.plot.ly/plotly-2.35.2.min.js" charset="utf-8"></script>

  <!-- Data (build_data.py tarafindan uretilir) -->
  <script src="js/data.js"></script>

  <!-- App (ana sayfa mantigi) -->
  <script src="js/app.js"></script>

  <!-- Detail (detay paneli mantigi) -->
  <script src="js/detail.js"></script>

</body>
</html>
